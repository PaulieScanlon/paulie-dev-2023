---
const { slug } = Astro.props;
---

<astro-analytics data-slug={slug}></astro-analytics>
<script async>
class AstroAnalytics extends HTMLElement {
  constructor() {
    super();
    (() => {
      // https://x.com/wardpeet/status/1706350257020223688?s=20
      // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon
      navigator.sendBeacon('/api/page-view', JSON.stringify({ date: new Date(), slug: this.dataset.slug }));
    })();
  }
}
customElements.define('astro-analytics', AstroAnalytics);
</script>
